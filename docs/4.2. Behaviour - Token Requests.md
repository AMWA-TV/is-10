# Behaviour: Tokens Requests

_(c) AMWA 2019, CC Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)_

## Grants

The implicit grant MUST NOT be used as it has been deprecated in Section 3.1.2. of the [OAuth 2.0 Best Common
Practice][oauth-bcp-13] guidelines.

The password grant SHOULD NOT be used as it has been deprecated in Section 3.4. of the [OAuth 2.0 Best Common
Practice][oauth-bcp-13] guidelines.

The Authorization Code Grant MUST be supported by the Authorization Server, and SHOULD act as the primary grant flow.
When used with Public Clients, this grant MUST be used alongside PKCE as outlined in [RFC 7636][RFC-7636], in-keeping
with the recommendations given in 3.1.1. of the [OAuth 2.0 Best Common Practice][oauth-bcp-13].

For browserless or hardware-constrained devices, the Device Authorization Flow SHOULD be used, as described in
[RFC 8628][RFC-8628].

It is RECOMMENDED that Section 5 of the OAuth 2.0 [Security Model][oauth-security-model] detailing Security
Considerations associated with OAuth 2.0 be followed as closely as possible to minimise chance of a security breach,
such as the leaking of Authorization codes or Refresh Tokens.

## Authorization Request and Response
_Found at the `/authorize` endpoint in the example implementation_

Successful authorization requests for the Authorization Code Grant SHALL be provided by registered clients as
defined in [RFC 6749][RFC-6749] Section 4.1.1.

The means by which the Authorization Server validates the end-user is not defined in this spec. Methods may include:
*   Basic Authorization (or other HTTP authentication scheme)
*   Login page and Session Cookies
*   Integration with a larger SSO authentication system

A successful authorization response SHALL be serviced by the Authorization Server as defined in [RFC 6749][RFC-6749]
Section 4.1.2. The use of the STATE parameter SHOULD be used. Use of the PKCE `code_challenge` parameter SHOULD be
implemented as outlined in [RFC 7636][RFC-7636].

## Access Token Request and Response
_Found at the `/token` endpoint in the example implementation_

Access token requests SHALL be provided by clients as defined in [RFC 6749][RFC-6749] Section 4 based on the OAuth
2.0 grant being used.

Successful access token responses SHALL be serviced by the Authorization Server as defined in [RFC 6749][RFC-6749]
Section 5.1. Additionally the `expires_in` and `refresh_token` fields MUST be included in the response.

## Refresh Tokens

A refresh token is a string representing the authorization granted to the client by the resource owner in line with
Section 1.5 of [RFC 6749][RFC-6749].

Authorization Servers MUST issue refresh tokens in the Bearer token returned after the completion of an authentication
flow. Refresh tokens MAY be valid indefinitely or MAY be time-limited.

## Token Revocation
_Found at the `/revoke` endpoint in the example implementation_

Access Tokens and Refresh Tokens SHALL be revoked by the Authorization Server as defined by [RFC 7009][RFC-7009].

OAuth 2.0 clients SHALL revoke any valid refresh tokens using the recovation endpoint upon a user ceasing to require
authorization. This may be, for example, due to logging out of an application, a change of user identity or uninstalling
a given application.


[RFC-6749]: https://tools.ietf.org/html/rfc6749 "The OAuth 2.0 Authorization Framework"

[RFC-7009]: https://tools.ietf.org/html/rfc7009 "OAuth 2.0 Token Revocation"

[RFC-7636]: https://tools.ietf.org/html/rfc7636 "Proof Key for Code Exchange by OAuth Public Clients"

[RFC-8628]: https://tools.ietf.org/html/rfc8628 "OAuth 2.0 Device Authorization Grant"

[oauth-bcp-13]: https://tools.ietf.org/html/draft-ietf-oauth-security-topics-13 "OAuth 2.0 Security Best Current Practice 13"

[oauth-security-model]: https://tools.ietf.org/html/rfc6819 "OAuth 2.0 Threat Model and Security Considerations"
