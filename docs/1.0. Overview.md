# AMWA IS-10 NMOS Authorization Specification: Overview

_(c) AMWA 2019, CC Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)_

## Documentation

The documents included in this directory provide additional details and recommendations for
implementations of the defined API, and its consumers.

Familiarity with the [JT-NM reference architecture](http://jt-nm.org/) is assumed, and further
definitions of OAuth 2.0 concepts as they apply to NMOS are found in both the
[Definitions](./5.0.%20Definitions) section and the [OAuth 2.0 spec][RFC-6749].

## Use of Normative Language

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
"RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC
2119][RFC-2119].

## Introduction

This document covers the mechanism by which access tokens are requested from an Authorization Server,
against which an AMWA NMOS API Resource Server may verify that a client and/or user accessing it has
the privileges required to access or modify some or all of the content using the API.

Use of insecure communication (plain HTTP etc.) is forbidden within the scope of this document.
Whilst his document is not concerned with the security of the connection used to carry out
authorization or subsequently authorised interactions, for the authorization mechanisms described in
this document to be effective the connection used MUST be secured.
Implementation of [BCP-003-01][BCP-003-01] is a RECOMMENDED prerequisite to implementing this
document.

The Authorization Server SHALL present an instance of the NMOS [Authorization
API](../APIs/AuthorizationAPI.raml).

The Authorization Server MAY present multiple versions of the API on the same port, but MUST
name-space them accordingly as per the API specification.

The Authorization Server and client authentication methods MUST otherwise be implemented as per the
OAuth 2.0 Authorization Framework [RFC 6749][RFC-6749]. All tokens produced by the Authorization
Server MUST be Bearer Tokens using the JSON Web Token (JWT) profile as per [RFC 7523][RFC-7523].

## Authorization Flow (informative)

A simplified illustration of the authorization flow is shown below. The API client, in this case a
broadcast control system, provides the client's credentials to the Authorization Server, which
verifies them. The mechanism used to verify client credentials is out of scope for this document, but
may involve widely used authentication technologies such as a corporate Single Sign On, Kerberos or
Microsoft Active Directory for example.

In its request, the client will also indicate what privileges it wants included in a token. If the
Authorization Server concurs that a given client may be permitted the privileges requested, it will
grant a Bearer Token containing an Authorization Token whose "claims" include the requested
privileges.

The client uses the Authorization Token it has been issued with when it makes requests to protected
resources on the Resource Server. The Resource Server then validates the token, using the public key
of the Authorization Server. If the Resource Server finds that the token is valid for the protected
resource to be accessed, it will allow the API request to proceed.

![Authorization Flow](images/nmos_sec_3.png)

Tokens are signed using a long-lived private key held by the Authorization Server. The Authorization
Server makes available its public key to Resource Servers, to allow them to validate tokens using
that key.

The Bearer Token issued by the Authorization Server are much shorter-lived than the Authorization
Server secret key, but longer-lived than the Access Token. This means that the client may readily
employ the access token without needing to ask the end-user for their credentials, but allows system
administrators the opportunity to revoke access to the protected resources by the client by refusing
to issue a new access token when asked for a renewal.

## OAuth Grants

### Client Types (Informative)

[RFC 6749][RFC-6749] defines three different classes of OAuth 2.0 Client:
- Web application - client credentials stored in a server.
- User-agent-based application - client credentials stored in the user-agent (e.g browser).
- Native application - client credentials stored in a native application (e.g broadcast control
  system).

It is important to understand what kind of client is being implemented, as this impacts on the OAuth
2.0 grant that it may use.

Typically clients for NMOS APIs are Broadcast Control Systems, or the broadcast equipment they control
(a "Node" in the [JT-NM Reference Architecture](http://jt-nm.org/RA-1.0/)).

Clearly a broadcast control system that is built as a native app is a "Native Application" type, and
a control system implemented in a browser is a "User-agent-based application", and they should be
treated accordingly when implementing OAuth. [RFC 6749][RFC-6749] defines both these client types to
be _Public Clients_.

Out of these three client types an NMOS Node most closely resembles a web application, because client
credentials are not stored in the user-agent or a native application.
Instead they are stored on a server away from the resource owner.
The web application client type is the only OAuth 2.0 client type where this is permitted to be the
case. [RFC 6749][RFC-6749] considers such clients to be _Confidential Clients_.

### Grant Types

OAuth 2.0 defines four different grant types:

- Authorization Code Grant
- Implicit Grant
- Resource Owner Password Credentials Grant
- Client Credentials Grant.

The authorization code grant is optimised for confidential clients, and is a good choice for NMOS
Node type clients devices, but is less well suited to control system type clients.

The implicit grant is designed for public clients, and therefore is unsuited to confidential clients,
but is generally used for use-agent based clients.

The resource owner password grant is designed for situations where the resource owner has a strong
trust relationship with the client - this is typically reserved for clients like operating systems or
other highly privileged software. This may be the case for native application broadcast control
systems, but not those implemented in the user-agent (e.g browser). This grant is not suitable for
NMOS Node type clients.

The client authentication grant is suitable for confidential clients, but requires the resource owner
arrange for the Authorization Server to allow access to protected resources out of band rather than
as part of the grant process.
This may be suitable for use with NMOS, especially where the Authorization Server forms part of a
larger broadcast control system.

Individual AMWA NMOS specifications MAY specify the grants permitted for the API clients involved in
the specification, however the guidance above for the suitability of different grants for user with
certain clients SHOULD be followed. Unless otherwise specified by the AMWA NMOS Specifications it
supports, an Authorization Server SHOULD support all four grant flows.

[RFC-2119]: https://tools.ietf.org/html/rfc2119 "Key words for use in RFCs"

[RFC-6749]: https://tools.ietf.org/html/rfc6749 "The OAuth 2.0 Authorization Framework"

[RFC-7523]: https://tools.ietf.org/html/rfc7523 "JSON Web Token (JWT) Profile"

[BCP-003-01]: https://github.com/AMWA-TV/nmos-api-security/blob/v1.0-dev/best-practice-secure-comms.md
